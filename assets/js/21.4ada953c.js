(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{195:function(n,e,S){"use strict";S.r(e);var t=S(3),a=function(n){n.options.__data__block__={mermaid_1a962850:"sequenceDiagram\n    participant USER as Operator/Cashier\n    participant APP as PCPOS/APPPOS\n    participant DS as DS或支付SDK\n    participant ATS as 现金机\n    participant ATSP as 现金机集中服务管理\n    autonumber\n    USER->>APP: 登录系统\n    APP->>DS: 连接外设\n    rect rgba(0, 255, 0, .1)\n    Note over DS,ATS: 设置POS机的IP和端口号\n    DS->>ATS: RegisterEventRequest\n    ATS--\x3e>DS: RegisterEventResponse\n    end\n    alt 同步时间\n    rect rgba(0, 255, 0, .1)\n    Note over DS,ATS: 设置当前的时间\n    DS->>ATS: AdjustTimeRequest\n    ATS--\x3e>DS: AdjustTimeResponse\n    end\n    end\n    rect rgba(0, 255, 0, .1)\n    Note over DS,ATS: Set RequireVerification:1\n    DS->>ATS: GetStatusRequest\n    ATS--\x3e>DS: GetStatusResponse\n    end\n    alt idle空闲\n    DS->>ATS: InventoryRequest\n    ATS--\x3e>DS: InventoryResponse\n    else Device Error设备故障\n    DS->>ATS: ResetRequest\n    ATS--\x3e>DS: ResetResponse\n    ATS--\x3e>DS: InventoryEvent\n    else Device Configuration Error配置错误\n    USER->>ATS: Change to collect configuration via WebSetting\n    USER->>ATS: Empty the inventory in device\n    USER->>ATS: 重启机器\n    else Require Verification\n    Note over DS,ATS: See Release Require Verification Sequence\n    end\n",mermaid_382ee145:"sequenceDiagram\n    participant APP as PCPOS/APPPOS\n    participant STS as 交易服务\n    participant SPS as 支付服务\n    participant DS as DS或支付SDK\n    participant ATS as 现金机\n    participant ATSP as 现金机集中服务管理\n    autonumber\n    APP->>STS: 发起一次支付请求,保存支付请求\n    STS->>SPS: 保存本次支付请求信息\n    STS--\x3e>APP: 返回可以开始支付\n    APP->>DS: 发起支付请求\n    rect rgba(0, 255, 0, .1)\n    DS->>ATS: 调用硬件支付接口请求\n    ATS--\x3e>DS: 返回结果\n    end\n    opt 如果需要汇报后台\n    ATS->>ATSP: 状态汇报\n    end\n    opt 如果是PC端设备服务\n    DS--\x3e>SPS: 端侧服务异步通知结果到服务侧\n    end\n    DS--\x3e>APP: 返回结果\n\n    APP->>STS: 检查是否有未完成的支付请求\n    Note over APP,SPS: 支付发生意外或重新加载购物车需检查有没有未完成的支付\n    alt 存在未完成的支付请求\n    STS->>SPS: 检查是否支付已经完成\n    SPS--\x3e>STS: 返回支付结果\n    end\n    STS--\x3e>APP: 返回结果\n    alt 支付请求超时未收到结果或支付返回码明确需要查询确认结果       \n        loop 3-n次查询超时或100秒内轮询等待\n            APP->>DS: 查询结果（如果支持查询接口）\n            rect rgba(0, 255, 0, .1)\n            DS->>ATS: 调用ATS查询\n            ATS->>DS: 返回结果 \n            end\n        end\n        alt 查到已正常收钱\n            APP->>STS: 发送支付成功结果\n            STS->>SPS: 更新支付结果\n        else 未查到结果与客户确认已放钱进机器\n            APP->>STS: 异常结单\n            APP->>STS: 发送支付异常结果\n            STS->>SPS: 更新支付结果\n        else 查到机器未收钱或未查到结果与客户确认未放钱\n            APP->>STS: 发送支付失败结果\n            STS->>SPS: 更新支付结果\n            Note right of STS: 首笔可返回未支付状态\n        end\n    else 支付请求返回失败\n        alt 交易结果未知，返回码明确要求人工确认是否扣款\n            alt 与客户确认已扣款\n             APP->>STS: 异常结单\n             APP->>STS: 发送支付异常结果\n             STS->>SPS: 更新支付结果\n            else 与客户确认未扣款\n            APP->>STS: 发送支付失败结果\n            Note right of STS: 首笔可返回未支付状态\n            end\n        else 系统确认未扣款\n            APP->>STS: 发送支付失败结果\n            STS->>SPS: 更新支付结果\n            Note right of STS: 首笔可返回未支付状态\n        end\n    else 支付成功 \n    APP->>STS: 发送支付成功结果\n    STS->>SPS: 更新支付结果\n    end\n"}},r=Object(t.a)({},(function(){var n=this,e=n.$createElement,S=n._self._c||e;return S("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[S("h2",{attrs:{id:"现金机方案"}},[S("a",{staticClass:"header-anchor",attrs:{href:"#现金机方案"}},[n._v("#")]),n._v(" 现金机方案")]),n._v(" "),S("h3",{attrs:{id:"初始化交互时序图"}},[S("a",{staticClass:"header-anchor",attrs:{href:"#初始化交互时序图"}},[n._v("#")]),n._v(" 初始化交互时序图")]),n._v(" "),S("Mermaid",{attrs:{id:"mermaid_1a962850",graph:n.$dataBlock.mermaid_1a962850}}),S("h3",{attrs:{id:"正向交易交互时序图"}},[S("a",{staticClass:"header-anchor",attrs:{href:"#正向交易交互时序图"}},[n._v("#")]),n._v(" 正向交易交互时序图")]),n._v(" "),S("Mermaid",{attrs:{id:"mermaid_382ee145",graph:n.$dataBlock.mermaid_382ee145}})],1)}),[],!1,null,null,null);"function"==typeof a&&a(r);e.default=r.exports}}]);