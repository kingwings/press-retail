(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{194:function(S,n,P){"use strict";P.r(n);var e=P(3),t=function(S){S.options.__data__block__={mermaid_1a962850:"\nsequenceDiagram\n    participant APP as PCPOS/APPPOS\n    participant STS as STS\n    participant SPS as 支付服务\n    participant DS as DS或支付SDK\n    participant PSP as 聚合支付服务\n    participant CUP as 银联或收单行\n    autonumber\n    APP->>STS: 发起一次支付请求,保存支付请求\n    STS->>SPS: 保存本次支付请求信息\n    STS--\x3e>APP: 返回可以开始支付\n    APP->>DS: 发起支付请求\n    alt PSP\n    DS->>PSP: 发起支付请求\n    PSP->>CUP: 发起支付请求\n    CUP--\x3e>PSP: 返回结果\n    PSP--\x3e>DS: 返回结果\n    PSP--\x3e>SPS: 异步通知结果\n    else 银商MIS\n    DS->>CUP: 发起支付请求\n    CUP--\x3e>DS: 返回结果\n    DS->>SPS: 上传支付结果\n    end\n    DS--\x3e>APP: 返回结果\n\n    APP->>STS: 检查是否有未完成的支付请求\n    Note over APP,SPS: 支付发生意外或重新加载购物车需检查有没有未完成的支付\n    alt 存在未完成的支付请求\n    STS->>SPS: 检查是否支付已经完成\n    SPS--\x3e>STS: 返回支付结果\n    end\n    STS--\x3e>APP: 返回结果\n    alt 支付请求超时未收到结果或支付返回码明确需要查询确认结果\n        alt 直连微信支付宝或PSP\n            loop 3-n次查询超时或100秒内轮询等待\n                APP->>SPS: 调用查询结果\n                Note over APP,SPS: 如果STS需要知道支付结果，本调用可以先经过STS，然后经由STS再调用SPS\n                SPS->>SPS: 检查是否已收到异步通知结果\n                alt 未收到结果但支付通道查询接口可查\n                SPS->>PSP: 查询支付结果\n                PSP->>CUP: 查询\n                CUP--\x3e>PSP: 返回支付结果\n                PSP--\x3eSPS: 返回支付结果\n                end\n                SPS--\x3e>APP: 返回结果\n            end\n        else 调用SDK（银商MIS不支持查询，不支持异步通知）\n            loop 3次\n                APP->>DS: 查询结果（如果支持查询接口）\n                DS->>PSP: 调用PSP查询\n                PSP->>CUP: 调用银商查询\n                CUP--\x3e>APP:返回结果   \n            end\n        end\n        alt 查到已扣款\n            APP->>STS: 发送支付成功结果\n            STS->>SPS: 更新支付结果\n        else 未查到结果与客户确认已扣款\n            APP->>STS: 异常结单\n            APP->>STS: 发送支付异常结果\n            STS->>SPS: 更新支付结果\n        else 查到未扣款或未查到结果与客户确认未扣款\n            APP->>STS: 发送支付失败结果\n            STS->>SPS: 更新支付结果\n            Note right of STS: 首笔可返回未支付状态\n        end\n    else 支付请求返回失败\n        alt 交易结果未知，返回码明确要求人工确认是否扣款\n            alt 与客户确认已扣款\n             APP->>STS: 异常结单\n             APP->>STS: 发送支付异常结果\n             STS->>SPS: 更新支付结果\n            else 与客户确认未扣款\n            APP->>STS: 发送支付失败结果\n            Note right of STS: 首笔可返回未支付状态\n            end\n        else 系统确认未扣款\n            APP->>STS: 发送支付失败结果\n            STS->>SPS: 更新支付结果\n            Note right of STS: 首笔可返回未支付状态\n        end\n    else 支付成功 \n    APP->>STS: 发送支付成功结果\n    STS->>SPS: 更新支付结果\n    end\n"}},a=Object(e.a)({},(function(){var S=this,n=S.$createElement,P=S._self._c||n;return P("ContentSlotsDistributor",{attrs:{"slot-key":S.$parent.slotKey}},[P("h2",{attrs:{id:"刷卡支付"}},[P("a",{staticClass:"header-anchor",attrs:{href:"#刷卡支付"}},[S._v("#")]),S._v(" 刷卡支付")]),S._v(" "),P("h3",{attrs:{id:"交互时序图"}},[P("a",{staticClass:"header-anchor",attrs:{href:"#交互时序图"}},[S._v("#")]),S._v(" 交互时序图")]),S._v(" "),P("Mermaid",{attrs:{id:"mermaid_1a962850",graph:S.$dataBlock.mermaid_1a962850}})],1)}),[],!1,null,null,null);"function"==typeof t&&t(a);n.default=a.exports}}]);